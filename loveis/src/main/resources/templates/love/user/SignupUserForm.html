<!DOCTYPE html>
<html data-bs-theme="light" lang="en-US" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>회원가입</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="description" content="회원가입 페이지" />
    <meta name="keywords" content="회원가입" />
    <meta name="author" content="" />
    <meta name="MobileOptimized" content="320" />
    <link rel="icon" type="image/png" href="/love/assets/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/owl.carousel.css" />
    <link rel="stylesheet" type="text/css" href="/love/assets/css/animate.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="/love/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/responsive.css">
    <style>
        /* 달력이 다른 요소들 위에 표시되도록 z-index 조정 */
        .ui-datepicker {
            z-index: 9999 !important; /* 매우 높은 값으로 설정 */
            position: absolute;
        }
        
        /* 날짜 선택기 커스텀 스타일 */
        .date-picker-container {
            position: relative;
        }
        
        .date-picker-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #ff6b6b;
            z-index: 2;
        }
        
        #dob {
            padding-left: 40px;
            position: relative;
            z-index: 1;
        }
        
        /* 파일 업로드 커스텀 스타일 */
        .file-upload-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .file-upload-label {
            display: block;
            margin-bottom: 10px;
        }
        
        .file-upload-wrapper {
            display: inline-block;
            position: relative;
            width: 100%;
            max-width: 300px;
        }
        
        .file-upload-btn {
            background: #f8f9fa;
            border: 1px dashed #ddd;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .file-upload-btn i {
            color: #ff6b6b;
            margin-right: 8px;
        }
        
        #profileImage {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .selected-file {
            margin-top: 8px;
            font-size: 14px;
            color: #495057;
        }
        
        /* 이미지 미리보기 스타일 */
        .image-preview {
            text-align: center;
        }
        
        .preview-image {
            border: 1px solid #ddd;
            padding: 5px;
            background: #f8f9fa;
        }
        
        /* 유효성 검사 스타일 */
        .form-input input:required:invalid {
            border-color: #ff3860;
        }
        
        .form-input input:required:valid {
            border-color: #09c372;
        }
        
        .error-message {
            color: #ff3860;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .form-input.invalid label i {
            color: #ff3860;
        }
        
        .form-input.invalid input {
            border-color: #ff3860;
        }
    </style>
</head>

<body>
    <div class="preloder" id="preloder">
        <div class="heart">
            <div class="heart-piece-0"></div>
            <div class="heart-piece-1"></div>
            <div class="heart-piece-2"></div>
            <div class="heart-piece-3"></div>
            <div class="heart-piece-4"></div>
            <div class="heart-piece-5"></div>
            <div class="heart-piece-6"></div>
            <div class="heart-piece-7"></div>
            <div class="heart-piece-8"></div>
            <p>loading...</p>
        </div>
    </div>
    <div class="main-singin-box">
        <div class="container">
            <div class="singin-box" style="width: 100%; max-width: 600px; margin: 0 auto;">
                <div class="singin-right" style="width: 100%;">
                    <div class="main-form">
                        <h4 style="text-align: center; margin-bottom: 25px;">회원가입</h4>
                        <form th:action="@{/register}" method="post" enctype="multipart/form-data" novalidate id="registerForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- 이름 -->
                                    <div class="form-input">
                                        <input type="text" name="name" id="name" placeholder="이름" required>
                                        <label for="name"><i class="fas fa-user"></i></label>
                                    </div>
                                    
                                    <!-- 비밀번호 -->
                                    <div class="form-input">
                                        <input type="password" name="password" id="password" placeholder="비밀번호" required>
                                        <label for="password"><i class="fas fa-lock"></i></label>
                                    </div>
                                    
                                    <!-- 이메일 -->
                                    <div class="form-input">
                                        <input type="email" name="email" id="email" placeholder="이메일 주소" required>
                                        <label for="email"><i class="fas fa-envelope"></i></label>
                                    </div>
                                    
                                    <!-- 전화번호 -->
                                    <div class="form-input">
                                        <input type="tel" name="phone" id="phone" placeholder="전화번호" required>
                                        <label for="phone"><i class="fas fa-phone"></i></label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <!-- 아이디 -->
                                    <div class="form-input">
                                        <input type="text" name="username" id="username" placeholder="아이디" required>
                                        <label for="username"><i class="fas fa-id-card"></i></label>
                                    </div>
                                    
                                    <!-- 비밀번호 확인 -->
                                    <div class="form-input">
                                        <input type="password" name="confirmPassword" id="confirmPassword" placeholder="비밀번호 확인" required>
                                        <label for="confirmPassword"><i class="fas fa-lock"></i></label>
                                    </div>
                                    
                                    <!-- 생년월일 -->
                                    <div class="form-input date-picker-container">
                                        <i class="fas fa-birthday-cake"></i>
                                        <input type="text" name="dob" id="dob" placeholder="생년월일 선택" required>
                                    </div>
                                    
                                    <!-- 닉네임 -->
                                    <div class="form-input">
                                        <input type="text" name="nickname" id="nickname" placeholder="닉네임" required>
                                        <label for="nickname"><i class="fas fa-user-tag"></i></label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 주소 -->
                            <div class="form-input">
                                <input type="text" name="userZipcode" id="sample5_address" placeholder="주소" required readonly onclick="openPostcode()">
                                <label for="userZipcode"><i class="fas fa-home"></i></label>
                            </div>
                            <div id="map" style="width:300px;height:300px;margin-top:10px;display:none"></div>
                            
                            <!-- 사진 업로드 -->
                            <div class="file-upload-container">
                                <label class="file-upload-label">프로필 사진</label>
                                <div class="file-upload-wrapper">
                                    <label for="profileImage" class="file-upload-btn">
                                        <i class="fas fa-camera"></i>
                                        파일 선택
                                    </label>
                                    <input type="file" name="profileImage" id="profileImage" accept="image/*">
                                </div>
                                <!-- 이미지 미리보기 영역 추가 -->
                                <div class="image-preview" id="imagePreview" style="display: none; margin-top: 15px;">
                                    <img src="" alt="Image Preview" class="preview-image" style="max-width: 200px; max-height: 200px; border-radius: 4px;">
                                </div>
                            </div>
                            
                            <!-- 약관 동의 -->
                            <div class="form-input-checkbox" style="text-align: center; margin: 20px 0;">
                                <input type="checkbox" name="termsAgreed" id="termsAgreed" required>
                                <label for="termsAgreed">이용약관 및 개인정보 처리방침에 동의합니다</label>
                            </div>
                            
                            <!-- 제출 버튼 -->
                            <div class="form-input" style="text-align: center;">
                                <button class="main-btn" type="submit" style="width: 200px; margin: 0 auto;">회원가입</button>
                            </div>
                        </form>
                        <p style="text-align: center; margin-top: 20px;">이미 회원이신가요? <a href="/love/user/LoginUserForm">로그인</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery 먼저 로드 -->
    <script src="/love/assets/js/jquery-3.6.0.min.js"></script>
    
    <!-- 2. 다음 우편번호 서비스 API 로드 (HTTPS로 변경) -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    
    <!-- 3. Kakao 지도 API 로드 (HTTPS로 변경) -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ac2a7b0cef49cda50890b639c7d28462&libraries=services"></script>
    
    <!-- 다음 우편번호 서비스 API 동적 로드 -->
    <script>
 // 전역 변수로 지도 객체 저장
    var map, geocoder, marker;
    
    // 지도 초기화 함수
    function initMap() {
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.537187, 127.005476),
            level: 5
        };

        // 지도 생성
        map = new kakao.maps.Map(mapContainer, mapOption);
        // 주소-좌표 변환 객체 생성
        geocoder = new kakao.maps.services.Geocoder();
        // 마커 생성
        marker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(37.537187, 127.005476),
            map: map
        });
    }
    
    // 주소 검색 함수
    window.openPostcode = function() {
        // Kakao 지도 API가 로드되었는지 확인
        if (typeof daum === 'undefined' || typeof daum.Postcode === 'undefined') {
            alert('주소 검색 서비스를 불러오는 중입니다. 잠시 후 다시 시도해주세요.');
            return;
        }
        
        new daum.Postcode({
            oncomplete: function(data) {
                var addr = data.address;
                document.getElementById("sample5_address").value = addr;
                
                // 주소로 좌표 검색
                if (geocoder) {
                    geocoder.addressSearch(data.address, function(results, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            var result = results[0];
                            var coords = new kakao.maps.LatLng(result.y, result.x);
                            
                            // 지도 표시
                            document.getElementById('map').style.display = "block";
                            map.relayout();
                            map.setCenter(coords);
                            marker.setPosition(coords);
                        }
                    });
                }
            },
            onerror: function(error) {
                console.error('주소 검색 오류:', error);
                alert('주소 검색 중 오류가 발생했습니다.');
            }
        }).open();
    };
    </script>
    
    <!-- 기타 스크립트 -->
    <script src="/love/assets/js/jquery-ui.min.js"></script>
    <script src="/love/assets/js/bootstrap.min.js"></script>
    <script src="/love/assets/js/bootstrap.bundle.js"></script>
    <script src="/love/assets/js/vanilla-tilt.min.js"></script>
    <script src="/love/assets/js/owl.carousel.js"></script>
    <script src="/love/assets/js/range-slider.js"></script>
    <script src="/love/assets/js/custom.js"></script>
    
    <script>
        $(document).ready(function() {
            // 날짜 선택기 초기화
            $("#dob").datepicker({
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true,
                yearRange: '1900:+0'
            });
            
            $(window).on("load resize", function () {
                var windowHeight = $(window).height();
                $(".main-singin-box").css({ 
                    "min-height": windowHeight,
                    "height": "auto"
                });
            });
            
            // 파일 선택 이벤트 처리
            $("#profileImage").change(function() {
                const file = this.files[0];
                
                if (file) {
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            $("#imagePreview").show();
                            $("#imagePreview .preview-image").attr('src', e.target.result);
                        }
                        
                        reader.readAsDataURL(file);
                    } else {
                        alert('이미지 파일만 업로드 가능합니다.');
                        $(this).val('');
                        $("#imagePreview").hide();
                    }
                } else {
                    $("#imagePreview").hide();
                }
            });
        
            // 유효성 검사 함수
            function validateField(field) {
                const $field = $(field);
                const value = $field.val().trim();
                const $formGroup = $field.closest('.form-input');
                const $error = $formGroup.find('.error-message');
                
                if ($field.prop('required') && !value) {
                    $formGroup.addClass('invalid');
                    $error.text('이 필드는 필수 입력 항목입니다.').show();
                    return false;
                }
                
                // 특정 필드에 대한 추가 검증
                if ($field.attr('id') === 'email' && value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        $formGroup.addClass('invalid');
                        $error.text('유효한 이메일 주소를 입력해주세요.').show();
                        return false;
                    }
                }
                
                if ($field.attr('id') === 'password' && value.length < 6) {
                    $formGroup.addClass('invalid');
                    $error.text('비밀번호는 최소 6자 이상이어야 합니다.').show();
                    return false;
                }
                
                if ($field.attr('id') === 'confirmPassword' && value) {
                    const password = $('#password').val();
                    if (value !== password) {
                        $formGroup.addClass('invalid');
                        $error.text('비밀번호가 일치하지 않습니다.').show();
                        return false;
                    }
                }
                
                if ($field.attr('id') === 'phone' && value) {
                    const phoneRegex = /^[0-9]{10,11}$/;
                    if (!phoneRegex.test(value)) {
                        $formGroup.addClass('invalid');
                        $error.text('유효한 전화번호를 입력해주세요.').show();
                        return false;
                    }
                }
                
                $formGroup.removeClass('invalid');
                $error.hide();
                return true;
            }
        
            // 모든 필드에 에러 메시지 요소 추가
            $('.form-input input[required]').each(function() {
                $(this).after('<div class="error-message"></div>');
            });
        
            // 실시간 유효성 검사
            $('.form-input input').on('blur', function() {
                validateField(this);
            });
        
            // 폼 제출 시 전체 검증
            $('#registerForm').on('submit', function(e) {
                let isValid = true;
                
                $('.form-input input[required]').each(function() {
                    if (!validateField(this)) {
                        isValid = false;
                       
                     	// 첫 번째 잘못된 입력 필드로 focus 이동
                        $(this).focus();

                        // 바로 멈추고 return false (jQuery each에서 루프 빠져나옴)
                        return false;
                    }
                });
                
                // 약관 동의 확인
                if (!$('#termsAgreed').is(':checked')) {
                    isValid = false;
                    $('#termsAgreed').next('label').css('color', '#ff3860');
                    alert('이용약관에 동의해주세요.');
                } else {
                    $('#termsAgreed').next('label').css('color', '');
                }
                
                if (!isValid) {
                    e.preventDefault();
                    $('html, body').animate({
                        scrollTop: $('.invalid').first().offset().top - 100
                    }, 500);
                }
            });
        });
    </script>
</body>
</html>