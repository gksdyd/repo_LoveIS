<!DOCTYPE html>
<html data-bs-theme="light" lang="ko" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>회원가입</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="description" content="회원가입 페이지" />
    <meta name="keywords" content="회원가입" />
    <meta name="author" content="" />
    <meta name="MobileOptimized" content="320" />
    <link rel="icon" type="image/png" href="/love/assets/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/owl.carousel.css" />
    <link rel="stylesheet" type="text/css" href="/love/assets/css/animate.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="/love/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/signUp.css">
</head>

<body>
    <div class="preloder" id="preloder">
        <div class="heart">
            <div class="heart-piece-0"></div>
            <div class="heart-piece-1"></div>
            <div class="heart-piece-2"></div>
            <div class="heart-piece-3"></div>
            <div class="heart-piece-4"></div>
            <div class="heart-piece-5"></div>
            <div class="heart-piece-6"></div>
            <div class="heart-piece-7"></div>
            <div class="heart-piece-8"></div>
            <p>loading...</p>
        </div>
    </div>
    <div class="main-singin-box">
        <div class="container">
            <div class="singin-box" style="width: 100%; max-width: 600px; margin: 0 auto;">
                <div class="singin-right" style="width: 100%;">
                    <div class="main-form">
                        <h4 style="text-align: center; margin-bottom: 25px;">회원가입</h4>
                        <form th:action="@{/register}" method="post" enctype="multipart/form-data" novalidate id="registerForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- 성별 -->
                                    <div class="form-input">
		                                <div class="custum-select">
											<select class="" id="gender" required>
												<option value="">&ensp;성별</option>
												<option th:each="gender : ${@codeService.selectListCachedCode(1)}" th:text="'&ensp;' + ${gender.codeName}" th:value="${gender.codeSeq}"></option>
											</select>
											<label for="gender"><i class="fas fa-male"></i><i class="fas fa-female"></i></label>
										</div>
		                            </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- 이름 -->
                                    <div class="form-input">
                                        <input type="text" name="name" id="name" placeholder="이름" required>
                                        <label for="name"><i class="fas fa-user"></i></label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                	<!-- 아이디 -->
                                    <div class="form-input">
                                        <input type="text" name=userId id="userId" placeholder="아이디" required>
                                        <label for="userId"><i class="fas fa-id-card"></i></label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                        		<div class="col-md-6">
                                    <!-- 비밀번호 -->
                                    <div class="form-input">
                                        <input type="password" name="password" id="password" placeholder="비밀번호" required>
                                        <label for="password"><i class="fas fa-lock"></i></label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                	<!-- 비밀번호 확인 -->
                                    <div class="form-input">
                                        <input type="password" name="confirmPassword" id="confirmPassword" placeholder="비밀번호 확인" required>
                                        <label for="confirmPassword"><i class="fas fa-lock"></i></label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                        		<div class="col-md-6">
                                    <!-- 이메일 -->
                                    <div class="form-input">
                                        <input type="email" name="email" id="email" placeholder="이메일 주소" required>
                                        <label for="email"><i class="fas fa-envelope"></i></label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                	<!-- 생년월일 -->
                                    <div class="form-input">
                                        <input type="text" name="dob" id="dob" placeholder="생년월일 선택" required>
                                        <label for="dob" style="z-index: 1;"><i class="fas fa-birthday-cake"></i></label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                        		<div class="col-md-6">
                                    <!-- 전화번호 -->
                                    <div class="form-input">
                                        <input type="text" name="phone" id="phone" placeholder="전화번호" maxlength="11" required>
                                        <label for="phone"><i class="fas fa-phone"></i></label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                	<!-- 닉네임 -->
                                    <div class="form-input">
                                        <input type="text" name="nickname" id="nickname" placeholder="닉네임" required>
                                        <label for="nickname"><i class="fas fa-user-tag"></i></label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                        		<div class="col-md-6">
                                    <!-- 도시 -->
		                            <div class="form-input">
		                                <div class="custum-select">
											<select class="" id="city" onchange="changeLocal(this)" required>
												<option value="">&ensp;도시</option>
												<option th:each = "list : ${list}" th:value="${list.ifcaSeq}" th:text="'&ensp;' + ${list.ifcaName}"></option>
											</select>
											<label for="city"><i class="fas fa-city"></i></label>
										</div>
		                            </div>
                                </div>
                                <div class="col-md-6">
                                	<!-- 지역 -->
		                            <div class="form-input">
		                                <div class="custum-select" id="changeLocal">
											<select class="" id="local" required>
												<option value="">&ensp;지역</option>
											</select>
											<label for="city"><i class="fas fa-location"></i></label>
										</div>
		                            </div>
                                </div>
                            </div>
                            
                            <!-- 사진 업로드 -->
                            <div class="file-upload-container">
                                <label class="file-upload-label">프로필 사진</label>
                                <div class="file-upload-wrapper">
                                    <label for="profileImage" class="file-upload-btn">
                                        <i class="fas fa-camera"></i>
                                        파일 선택
                                    </label>
                                    <input type="file" name="profileImage" id="profileImage" accept="image/*">
                                </div>
                                <!-- 이미지 미리보기 영역 추가 -->
                                <div class="image-preview" id="imagePreview" style="display: none; margin-top: 15px;">
                                    <img src="" alt="Image Preview" class="preview-image" style="max-width: 200px; max-height: 200px; border-radius: 4px;">
                                </div>
                            </div>
                            
                            <!-- 약관 동의 -->
                            <div class="form-input-checkbox">
                                <input type="checkbox" name="termsAgreed" id="termsAgreed" required>
                                <label for="termsAgreed">이용약관 및 개인정보 처리방침에 동의합니다</label>
                            </div>
                            
                            <!-- 제출 버튼 -->
                            <button class="main-btn" type="button" style="width: 200px; margin: 0 auto;">회원가입</button>
                        </form>
                        <p style="text-align: center; margin-top: 20px;">이미 회원이신가요? <a href="/love/member/LoginLoveForm">로그인</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery 먼저 로드 -->
    <script src="/love/assets/js/jquery-3.6.0.min.js"></script>
    
    <!-- 기타 스크립트 -->
    <script src="/love/assets/js/jquery-ui.min.js"></script>
    <script src="/love/assets/js/bootstrap.min.js"></script>
    <script src="/love/assets/js/bootstrap.bundle.js"></script>
    <script src="/love/assets/js/vanilla-tilt.min.js"></script>
    <script src="/love/assets/js/owl.carousel.js"></script>
    <script src="/love/assets/js/range-slider.js"></script>
    <script src="/love/assets/js/custom.js"></script>
    <script src="/love/assets/js/constant.js"></script>
    <script src="/love/assets/js/area.js"></script>
    
    <script>
        $(document).ready(function() {
            // 날짜 선택기 초기화
            $("#dob").datepicker({
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true,
                yearRange: '1900:+0'
            });
            
            $(window).on("load resize", function () {
                var windowHeight = $(window).height();
                $(".main-singin-box").css({ 
                    "min-height": windowHeight,
                    "height": "auto"
                });
            });
            
            // 파일 선택 이벤트 처리
            $("#profileImage").change(function() {
                const file = this.files[0];
                
                if (file) {
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            $("#imagePreview").show();
                            $("#imagePreview .preview-image").attr('src', e.target.result);
                        }
                        
                        reader.readAsDataURL(file);
                    } else {
                        alert('이미지 파일만 업로드 가능합니다.');
                        $(this).val('');
                        $("#imagePreview").hide();
                    }
                } else {
                    $("#imagePreview").hide();
                }
            });
        });
        
        $(".main-btn").on("click", function() {
        	if (!validation()) {
        		return;
        	}
            
            let formdata = new FormData();
            formdata.append("userGender", $("#gender").val());
            formdata.append("userName", $("#name").val());
            formdata.append("userId", $("#userId").val());
            formdata.append("userPassword", $("#password").val());
            formdata.append("userEmail", $("#email").val());
            formdata.append("userBirth", $("#dob").val());
            formdata.append("userPhone", $("#phone").val());
            formdata.append("userNickname", $("#nickname").val());
            formdata.append("userCity", $("#city").val());
            formdata.append("userLocal", $("#local").val());
            formdata.append("uploadImg1[]", $("#profileImage")[0].files[0]);
            formdata.append("uploadImg1Type", 1);
            formdata.append("uploadImg1MaxNumber", 1);

            $.ajax({
                async: true 
                ,cache: false
                ,type: "post"
                ,url: "/love/member/SignUpLoveProc"
                ,data: formdata
                ,processData: false
                ,contentType: false
                ,success: function(response) {
                    location = "/love/index/IndexLoveView";
                }
                ,error : function(jqXHR){
                    alert("ajaxUpdate " + jqXHR.textStatus + " : " + jqXHR.errorThrown);
                }
            });
        });
        
        function validation() {
			let count = $(".form-input").length;
        	
        	$(".valid").remove();
        	$("#termsAgreed").next().css("color", "");
        	
        	for(let i = 0; i < count; i++) {
        		if ($(".form-input").eq(i).find("input[type=text]").length > 0) {
        			let value = $(".form-input").eq(i).find("input[type=text]").val();
        			
        			if ($(".form-input").eq(i).find("input[type=text]").attr("id") === "name") {
        				if (value === "") {
        					let text = "<div class='valid' style='color: red;''>이름을 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				} else if (!NAME_CHECK.test(value)) {
        					let text = "<div class='valid' style='color: red;''>올바른 이름을 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			} else if ($(".form-input").eq(i).find("input[type=text]").attr("id") === "userId") {
        				if (value === "") {
        					let text = "<div class='valid' style='color: red;''>아이디를 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				} else if (!ID_CHECK.test(value)) {
        					let text = "<div class='valid' style='color: red;''>유효하지 않은 아이디입니다.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			} else if ($(".form-input").eq(i).find("input[type=text]").attr("id") === "dob") {
        				let now = new Date();
        				if (value === "") {
        					let text = "<div class='valid' style='color: red;''>생일을 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				} else if (now.getFullYear() - Number(value.substr(0, 4)) <= 19) {
        					let text = "<div class='valid' style='color: red;''>만 19세 이상 가입할 수 있습니다.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			} else if ($(".form-input").eq(i).find("input[type=text]").attr("id") === "phone") {
        				if (value === "") {
        					let text = "<div class='valid' style='color: red;''>핸드폰 번호를 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				} else if (!PHONE_CHECK.test(value)) {
        					let text = "<div class='valid' style='color: red;''>유효하지 않은 번호입니다.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			} else if ($(".form-input").eq(i).find("input[type=text]").attr("id") === "nickname") {
        				if (value === "") {
        					let text = "<div class='valid' style='color: red;''>닉네임을 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				} else if (!NICKNAME_CHECK.test(value)) {
        					let text = "<div class='valid' style='color: red;''>유효하지 않은 닉네임입니다.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			}
        		} else if ($(".form-input").eq(i).find("input[type=password]").length > 0) {
        			let value = $(".form-input").eq(i).find("input[type=password]").val();
        			
        			if ($(".form-input").eq(i).find("input[type=password]").attr("id") === "password") {
        				if (value === "") {
        					let text = "<div class='valid' style='color: red;''>비밀번호를 입력해주세요.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				} else if (!PASSWORD_CHECK.test(value)) {
        					let text = "<div class='valid' style='color: red;''>대문자 최소 1개, 소문자 최소 1개, 숫자 최소 1개, 특수문자 최소 1개</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			} else if ($(".form-input").eq(i).find("input[type=password]").attr("id") === "confirmPassword") {
        				if (value === "" || value !== $("#password").val()) {
        					let text = "<div class='valid' style='color: red;''>비밀번호가 일치하지 않습니다.</div>";
        					$(".col-md-6").eq(i).append(text);
        					return false;
        				}
        			}
        		} else if ($(".form-input").eq(i).find("input[type=email]").length > 0) {
					let value = $(".form-input").eq(i).find("input[type=email]").val();
        			
       				if (value === "") {
       					let text = "<div class='valid' style='color: red;''>이메일을 입력해주세요.</div>";
       					$(".col-md-6").eq(i).append(text);
       					return false;
       				} else if (!EMAIL_CHECK.test(value)) {
       					let text = "<div class='valid' style='color: red;''>올바른 이메일을 입력해주세요.</div>";
       					$(".col-md-6").eq(i).append(text);
       					return false;
       				}
        		} else if ($(".form-input").eq(i).find("select").length > 0) {
					let value = $(".form-input").eq(i).find("select").val();
        			
       				if (value === "") {
       					let text;
       					if ($(".form-input").eq(i).find("select").attr("id") === "city") {
       						text = "<div class='valid' style='color: red;''>도시를 선택해주세요.</div>";
       					} else if ($(".form-input").eq(i).find("select").attr("id") === "local") {
       						text = "<div class='valid' style='color: red;''>지역을 선택해주세요.</div>";
       					} else if ($(".form-input").eq(i).find("select").attr("id") === "gender") {
       						text = "<div class='valid' style='color: red;''>성별을 선택해주세요.</div>";
       					}
       					$(".col-md-6").eq(i).append(text);
       					return false;
       				}
        		}
        	}
        	
        	if ($("img").attr("src") === "") {
        		let text = "<div class='valid' style='color: red;''>사진을 선택해주세요.</div>";
        		$(".file-upload-container").append(text);
        		return false;
        	}
        	
        	if (!$("#termsAgreed").is(":checked")) {
        		$("#termsAgreed").next().css("color", "red");
        		return false;
        	}
        	return true;
        }
    </script>
</body>
</html>