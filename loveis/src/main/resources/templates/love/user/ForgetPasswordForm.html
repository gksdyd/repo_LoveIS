<!DOCTYPE html>
<html data-bs-theme="light" lang="en-US" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>비밀번호 찾기</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="description" content="fervor" />
    <meta name="keywords" content="fervor" />
    <meta name="author" content="" />
    <meta name="MobileOptimized" content="320" />
    <link rel="icon" type="image/png" href="/love/assets/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/owl.carousel.css" />
    <link rel="stylesheet" type="text/css" href="/love/assets/css/animate.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="/love/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="/love/assets/css/responsive.css">
    
    <style>
        /* 유효성 검사 메시지 스타일 */
        .error-message {
            color: #ff3860;
            font-size: 12px;
            margin-top: 5px;
            height: 18px;
            display: none;
        }
        .input-error {
            border-color: #ff3860 !important;
        }
        .input-success {
            border-color: #09c372 !important;
        }
        /* 기존 유효성 검사 메시지 숨기기 */
        input:invalid {
            box-shadow: none;
        }
        input:required:invalid {
            border-color: initial;
        }
    </style>
</head>

<body>
    <div class="preloder" id="preloder">
        <div class="heart">
            <div class="heart-piece-0"></div>
            <div class="heart-piece-1"></div>
            <div class="heart-piece-2"></div>
            <div class="heart-piece-3"></div>
            <div class="heart-piece-4"></div>
            <div class="heart-piece-5"></div>
            <div class="heart-piece-6"></div>
            <div class="heart-piece-7"></div>
            <div class="heart-piece-8"></div>
            <p>loading...</p>
        </div>
    </div>
    <div class="main-singin-box">
        <div class="container">
            <div class="singin-box d-flex justify-content-center">
                <div class="singin-right">
                    <div class="main-form">
                        <img src="/love/assets/images/login-logo-Image.png" alt="logo" style="max-width: 200px; display: block; margin: 0 auto; cursor: default;">
                        <form id="findPasswordForm" novalidate>
                            <div class="form-input">
                                <input type="text" name="username" id="username" placeholder="아이디(ID)">
                                <label for="username"><i class="fas fa-id-card"></i></label>
                                <div class="error-message" id="username-error"></div>
                            </div>
                            <div class="form-input">
                                <input type="text" name="name" id="name" placeholder="성함">
                                <label for="name"><i class="fas fa-user"></i></label>
                                <div class="error-message" id="name-error"></div>
                            </div>
                            <div class="form-input">
                                <input type="email" name="email" id="email" placeholder="이메일 주소">
                                <label for="email"><i class="fas fa-envelope"></i></label>
                                <div class="error-message" id="email-error"></div>
                            </div>
                            <div class="form-input">
                                <button class="main-btn" type="submit" id="findBtn">비밀번호 찾기</button>
                            </div>
                        </form>
                        <p>기억 나셨나요? <a href="/love/user/LoginUserForm">로그인</a> </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/love/assets/js/jquery-3.6.0.min.js"></script>
    <script src="/love/assets/js/jquery-ui.min.js"></script>
    <script src="/love/assets/js/bootstrap.min.js"></script>
    <script src="/love/assets/js/bootstrap.bundle.js"></script>
    <script src="/love/assets/js/vanilla-tilt.min.js"></script>
    <script src="/love/assets/js/owl.carousel.js"></script>
    <script src="/love/assets/js/range-slider.js"></script>
    <script src="/love/assets/js/custom.js"></script>
    <script>
    $(window).on("load resize", function () {
        windowHeight = $(window).height();
        $(".main-singin-box").css({ "height": windowHeight });
    });

    // 문서 준비 완료 시 실행
    $(document).ready(function() {
        // 폼에 novalidate 속성 추가로 기본 HTML5 유효성 검사 비활성화
        $('#findPasswordForm').attr('novalidate', true);
        
        // 필드 검사 상태 추적
        let hasInteracted = {
            username: false,
            name: false,
            email: false
        };
        
        /**
         * 아이디 유효성 검사 함수
         */
        function validateUsername() {
            const username = $('#username').val().trim();
            const usernameError = $('#username-error');
            
            if (username === '') {
                $('#username').addClass('input-error').removeClass('input-success');
                usernameError.text('아이디를 입력해주세요.').show();
                return false;
            }
            
            // 아이디 형식 검사 (영문, 숫자만 허용, 4자 이상)
            const regex = /^[a-zA-Z0-9]{4,}$/;
            if (!regex.test(username)) {
                $('#username').addClass('input-error').removeClass('input-success');
                usernameError.text('아이디는 4자 이상의 영문 또는 숫자로 입력해주세요.').show();
                return false;
            }
            
            // 유효성 통과
            $('#username').addClass('input-success').removeClass('input-error');
            usernameError.hide();
            return true;
        }
        
        /**
         * 성함 유효성 검사 함수
         */
        function validateName() {
            const name = $('#name').val().trim();
            const nameError = $('#name-error');
            
            if (name === '') {
                $('#name').addClass('input-error').removeClass('input-success');
                nameError.text('성함을 입력해주세요.').show();
                return false;
            }
            
            // 유효성 통과
            $('#name').addClass('input-success').removeClass('input-error');
            nameError.hide();
            return true;
        }
        
        /**
         * 이메일 유효성 검사 함수
         */
        function validateEmail() {
            const email = $('#email').val().trim();
            const emailError = $('#email-error');
            
            if (email === '') {
                $('#email').addClass('input-error').removeClass('input-success');
                emailError.text('이메일을 입력해주세요.').show();
                return false;
            }
            
            // 이메일 형식 검사
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!regex.test(email)) {
                $('#email').addClass('input-error').removeClass('input-success');
                emailError.text('올바른 이메일 형식이 아닙니다.').show();
                return false;
            }
            
            // 유효성 통과
            $('#email').addClass('input-success').removeClass('input-error');
            emailError.hide();
            return true;
        }
        
        // 아이디 입력 시 실시간 검사 (처음 입력 후부터)
        $('#username').on('input', function() {
            hasInteracted.username = true;
            validateUsername();
        });
        
        // 성함 입력 시 실시간 검사 (처음 입력 후부터)
        $('#name').on('input', function() {
            hasInteracted.name = true;
            validateName();
        });
        
        // 이메일 입력 시 실시간 검사 (처음 입력 후부터)
        $('#email').on('input', function() {
            hasInteracted.email = true;
            validateEmail();
        });
        
        // 필드 포커스 아웃 시 검사
        $('#username, #name, #email').on('blur', function() {
            const fieldId = $(this).attr('id');
            hasInteracted[fieldId] = true;
            
            if (fieldId === 'username') {
                validateUsername();
            } else if (fieldId === 'name') {
                validateName();
            } else {
                validateEmail();
            }
        });
        
        /**
         * 폼 제출 핸들러
         */
        $('#findPasswordForm').on('submit', function(e) {
            e.preventDefault();
            
            // 모든 필드에 대해 상호작용 플래그 설정
            hasInteracted.username = true;
            hasInteracted.name = true;
            hasInteracted.email = true;
            
            // 모든 필드 검사
            const isUsernameValid = validateUsername();
            const isNameValid = validateName();
            const isEmailValid = validateEmail();
            
            if (isUsernameValid && isNameValid && isEmailValid) {
                performFindPassword($('#username').val().trim(), $('#name').val().trim(), $('#email').val().trim());
            } else {
                // 유효성 검사 실패 시 첫 번째 오류 필드로 포커스 이동
                if (!isUsernameValid) {
                    $('#username').focus();
                } else if (!isNameValid) {
                    $('#name').focus();
                } else {
                    $('#email').focus();
                }
            }
        });
        
        /**
         * 비밀번호 찾기 수행 함수 (AJAX)
         */
        function performFindPassword(username, name, email) {
            // 로딩 표시
            $('#findBtn').prop('disabled', true).text('처리 중...');
            
            // AJAX로 비밀번호 찾기 요청
            $.ajax({
                async: true,
                cache: false,
                type: 'POST',
                url: '/love/user/findPassword', // 실제 비밀번호 찾기 엔드포인트로 변경(수정 필수)
                data: {
                    username: username,
                    name: name,
                    email: email
                },
                success: function(response) {
                    if (response.success) {
                        alert('입력하신 이메일로 비밀번호 재설정 링크가 발송되었습니다.');
                        window.location.href = '/love/user/LoginUserForm';
                    } else {
                        alert(response.message || '비밀번호 찾기에 실패했습니다. 정보를 확인해주세요.');
                        $('#findBtn').prop('disabled', false).text('비밀번호 찾기');
                    }
                },
                error: function() {
                    alert('서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
                    $('#findBtn').prop('disabled', false).text('비밀번호 찾기');
                }
            });
        }
    });
    </script>
</body>
</html>